/*! For license information please see Dependencies.e9eeb6133c877a3bb693.js.LICENSE.txt */
(self.webpackChunkncpasswords=self.webpackChunkncpasswords||[]).push([[6016,1693],{20448:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>i});const i={}},82434:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>i});const i={}},85108:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>i});const i={}},5554:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>i});const i={}},93178:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>i});const i={}},48379:(t,e,s)=>{var i=s(20448);i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[t.id,i,""]]),i.locals&&(t.exports=i.locals),(0,s(70534).A)("7a4db710",i,!1,{})},75013:(t,e,s)=>{var i=s(82434);i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[t.id,i,""]]),i.locals&&(t.exports=i.locals),(0,s(70534).A)("0be1042b",i,!1,{})},74147:(t,e,s)=>{var i=s(85108);i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[t.id,i,""]]),i.locals&&(t.exports=i.locals),(0,s(70534).A)("615328f8",i,!1,{})},19823:(t,e,s)=>{var i=s(5554);i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[t.id,i,""]]),i.locals&&(t.exports=i.locals),(0,s(70534).A)("6df7f8cc",i,!1,{})},38885:(t,e,s)=>{var i=s(93178);i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[t.id,i,""]]),i.locals&&(t.exports=i.locals),(0,s(70534).A)("4a11edad",i,!1,{})},76041:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>Z});var i=s(88724),r=s(87939),n=s(4311);class a extends n.H{constructor(t){super(t),this._enabled=!0,this._requests=[],this._activeRequests=0,this._queueCheckActive=!1,this._maxRequests=2,this._maxSlowRequests=1}initialize(t,e={}){super.initialize(t,e);let s=_.get("server.performance");0===s&&(this._maxRequests=2),s>0&&s<6&&(this._maxRequests=3*s),6===s&&(this._maxRequests=32),this._maxSlowRequests=2===this._maxRequests?1:2}disable(){this._enabled=!1,this.clear()}clear(){this._requests=[]}_sendRequest(t,e=null,s=null,i="application/json",r={}){return new Promise(((n,a)=>{let o=2,l=(Array.isArray(t)?t[0]:t).split(".");"service"===l[0]?(o=3,-1!==["favicon","preview"].indexOf(l[1])&&(o=4)):-1!==["create","update","delete","set"].indexOf(l[l.length-1])?o=1:"session"===l[0]&&(o=0),this._requests.push({resolve:n,reject:a,data:{path:t,data:e,method:s,dataType:i,requestOptions:r},priority:o}),this._checkRequestQueue()}))}_checkRequestQueue(){if(this._debug(),!this._queueCheckActive&&0!==this._requests.length&&this._enabled){for(this._queueCheckActive=!0,this._requests.sort((function(t,e){return t.priority===e.priority?0:t.priority<e.priority?-1:1}));this._activeRequests<this._maxRequests&&this._requests.length>0;){let t=this._requests.shift();if(t.priority>3&&this._activeRequests>this._maxSlowRequests||!this._enabled){this._requests.unshift(t);break}this._activeRequests++,super._sendRequest(t.data.path,t.data.data,t.data.method,t.data.dataType,t.data.requestOptions).then(t.resolve).catch(t.reject).finally((()=>{this._activeRequests>0&&this._activeRequests--,this._checkRequestQueue()}))}this._queueCheckActive=!1}}async _executeRequest(t,e){try{let s=new Request(t,e);return this._config.events.emit("api.request.before",s),await fetch(s,e)}catch(t){throw 401===t.status&&this._enabled&&(this._enabled=!1),this._config.events.emit("api.request.error",t),t}}_debug(){}}var o=s(87348);class l extends o._g{async _executeRequest(t,e){try{let s=new Request(t,e);return this._api.emit("request.before",s),await fetch(s,e)}catch(t){throw this._api.emit("request.error",t),t}}}const c=new class{constructor(){this._events=null,this._client=null}initialize(t,e,s,n=null){let o={baseUrl:t,user:e,token:s},c={baseUrl:t,user:e,token:s},h={legacy:()=>{let t=new a;return t.initialize(this.getClient(),this._getLegacyConfig()),t},"network.request":l},u=new i.A(h);this._client=new r.Ay(o,c,u),this._events=n}getClient(){return this._client}getLegacyClient(){return this.getClient().getInstance("legacy")}_getLegacyConfig(){let t=1===_.get("user.encryption.cse")?"CSEv1r1":"none",e={folderIcon:_.get("server.theme.folder.icon"),hashLength:_.get("user.password.security.hash"),cseMode:t};return null!==this._events&&(e.events=this._events),_.observe("user.password.security.hash",(t=>{this.getLegacyClient().config.hashLength=t.value})),e}},h=new Proxy({},{get(t,e,s){let i=c.getLegacyClient();const r=i[e];return r instanceof Function?function(...t){return r.apply(this===s?i:this,t)}:r}});var u=s(32981),d=s(90512),p=s(69159);const _=new class{constructor(){this._defaults={"client.ui.sort.ascending":!0,"client.ui.sort.field":"label","client.sharing.qrcode.warning":!0,"client.encryption.webauthn.enabled":!1,"client.encryption.passphrase.check":0,"client.ui.section.default":"folders","client.ui.password.field.title":"label","client.ui.password.field.sorting":"byTitle","client.ui.password.click.action":"password","client.ui.password.dblClick.action":"username","client.ui.password.wheel.action":"open-url","client.ui.password.custom.action":"none","client.ui.password.menu.copy":!1,"client.ui.password.user.show":!1,"client.ui.password.details.preview":!0,"client.ui.password.details.advanced":!1,"client.ui.password.print":!1,"client.ui.custom.fields.show.hidden":!1,"client.ui.list.tags.show":!1,"client.setup.initialized":!1,"client.search.show":!1,"client.search.live":!0,"client.search.global":!0,"client.settings.advanced":!1,"client.session.keepalive":0,"client.help.more.open":!1},this._settings=d.A.cloneObject(this._defaults),this._observers={}}set(t,e){this._settings[t]=e,this._triggerObservers(t,e),this._setSetting(t,e).then((s=>{s!==e&&(this._settings[t]=s,this._triggerObservers(t,s))}))}get(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:void 0!==e?e:null}async reset(t){let[e]=t.split(".",2);return"user"!==e&&"client"!==e||(this._settings[t]=await h.resetSetting(t),this._defaults.hasOwnProperty(t)&&(this._settings[t]=this._defaults[t])),this._triggerObservers(t,this._settings[t]).catch(p.A.exception),this._settings[t]}observe(t,e){Array.isArray(t)||(t=[t]);for(let s of t)this._observers.hasOwnProperty(s)||(this._observers[s]=[]),this._observers[s].push(e)}unobserve(t,e){Array.isArray(t)||(t=[t]);for(let s of t){if(!this._observers.hasOwnProperty(s))continue;let t=this._observers[s].indexOf(e);for(;-1!==t;)this._observers[s].splice(t,1),t=this._observers[s].indexOf(e)}}getAll(){return d.A.cloneObject(this._settings)}init(){let t=(0,u.C)("passwords","settings",null);t&&this._addSettings(t)}async _setSetting(t,e){let[s]=t.split(".",2);if("user"===s||"client"===s)return await h.setSetting(t,e)}_addSettings(t){for(let e in t)t.hasOwnProperty(e)&&null!==t[e]&&(this._settings[e]=t[e])}async _triggerObservers(t,e){if(this._observers.hasOwnProperty(t))for(let s=0;s<this._observers[t].length;s++)this._observers[t][s]({setting:t,value:e})}};var w=s(62893),g=function(){var t=this._self._c;return t("div",{staticClass:"passwords-widget",attrs:{id:"passwords-widget"}},[this.isAuthorized?t("passwords-view"):t("authentication-view")],1)};g._withStripped=!0;var f=s(21729),y=function(){var t=this,e=t._self._c;return e("div",{staticClass:"passwords-widget-list"},[t.hasSearch?e("password-search"):t._e(),t._v(" "),t.hasPasswords?e("ul",t._l(t.helper.passwords,(function(t){return e("password-item",{key:t.id,attrs:{password:t}})})),1):t.helper.ready?e("nc-empty-content",{attrs:{name:t.emptyText,description:t.emptyDescription},scopedSlots:t._u([{key:"icon",fn:function(){return[e("key-variant-icon",{attrs:{"fill-color":"var(--color-primary-text)",size:64}})]},proxy:!0}])}):e("nc-loading-icon",{attrs:{size:36}})],1)};y._withStripped=!0;var v=s(82418),m=s(18126),A=s(51025),b=function(){var t=this,e=t._self._c;return e("nc-list-item",{staticClass:"password-item",attrs:{name:t.password.label},on:{click:t.clickAction,dblclick:function(e){return t.doubleClickAction()}},scopedSlots:t._u([{key:"icon",fn:function(){return[e("favicon",{staticClass:"favicon",attrs:{domain:t.password.website,size:44}})]},proxy:!0},{key:"subname",fn:function(){return[t._v("\n        "+t._s(t.password.username)+"\n    ")]},proxy:!0},{key:"indicator",fn:function(){return[e("shield-half-full-icon",{attrs:{size:16,"fill-color":t.securityColor}})]},proxy:!0}])})};b._withStripped=!0;var q=s(1522),k=s(80914),x=function(){var t=this;return(0,t._self._c)("img",{attrs:{src:t.src,title:t.title,width:t.size,height:t.size,alt:""}})};x._withStripped=!0;const R=new class{constructor(){this._favicons={},this._requests={}}get(t,e=32){return this._favicons.hasOwnProperty(`${t}_${e}`)?this._favicons[`${t}_${e}`]:_.get("server.theme.app.icon")}async fetch(t,e=32){if(this._favicons.hasOwnProperty(`${t}_${e}`))return this._favicons[`${t}_${e}`];if(this._requests.hasOwnProperty(`${t}_${e}`))return await this._requests[`${t}_${e}`],this._favicons[`${t}_${e}`];let s=this._queueApiRequest(t,e);return await s}async _queueApiRequest(t,e){let s=this._fetchFromApi(t,e);return this._requests[`${t}_${e}`]=s,s}async _fetchFromApi(t,e){let s=_.get("server.theme.app.icon");try{let i=await h.getFavicon(t,e);return"image/"!==i.type.substr(0,6)||i.size<1?(delete this._requests[`${t}_${e}`],this._favicons.hasOwnProperty(`${t}_${e}`)||(this._favicons[`${t}_${e}`]=s),s):(this._favicons[`${t}_${e}`]=window.URL.createObjectURL(i),delete this._requests[`${t}_${e}`],this._favicons[`${t}_${e}`])}catch(i){return this._requests.hasOwnProperty(`${t}_${e}`)&&delete this._requests[`${t}_${e}`],this._favicons.hasOwnProperty(`${t}_${e}`)||(this._favicons[`${t}_${e}`]=s),s}}},C={props:{domain:String,size:{type:Number,default:32},title:{type:String,default:null}},data:()=>({src:_.get("server.theme.app.icon")}),mounted(){this.fetchIcon()},methods:{fetchIcon(){let t=this.domain,e=this.size;this.src=_.get("server.theme.app.icon"),R.fetch(t,e).then((s=>{this.domain===t&&this.size===e&&(this.src=s)}))}},watch:{domain(){this.fetchIcon()},size(){this.fetchIcon()}}};var P=s(14486);const S=(0,P.A)(C,x,[],!1,null,null,null).exports;var $=s(75289),O=s(80444);const L={components:{Favicon:S,NcListItem:q.A,ShieldHalfFullIcon:k.A},props:{password:{type:Object}},data:()=>({clickTimeout:null}),computed:{securityColor(){switch(this.password.status){case 0:return"var(--color-success)";case 1:return"var(--color-warning)";case 2:return"var(--color-error)";case 3:return"var(--color-main-text)"}}},methods:{clickAction(){if(this.clickTimeout)return this.doubleClickAction();let t=_.get("client.ui.password.click.action");"none"!==t&&this.runClickAction(t,"password",300)},doubleClickAction(){let t=_.get("client.ui.password.dblClick.action");"none"!==t&&(this.clearClickAction(),this.runClickAction(t,"username"))},runClickAction(t,e,s=0){"details"===t||"edit"===t||"print"===t?this.copyAction(t,e):"open-url"===t?this.openUrlAction(s):this.copyAction(t,s)},copyAction(t,e=0){this.clickTimeout=setTimeout((()=>{let e="Error copying {element} to clipboard";this.password.hasOwnProperty(t)&&0!==this.password[t].length?d.A.copyToClipboard(this.password[t])&&(e="{element} was copied to clipboard"):e="ClipboardCopyEmpty";let s=O.A.translate(t.charAt(0).toUpperCase()+t.slice(1));(0,$.showInfo)(O.A.translate(e,{element:s}),{}),this.clickTimeout=null}),e)},openUrlAction(t){this.clickTimeout=setTimeout((()=>{this.password.url&&d.A.openLink(this.password.url),this.clickTimeout=null}),t)},clearClickAction(){this.clickTimeout&&(clearTimeout(this.clickTimeout),this.clickTimeout=null)}}};s(75013);const T=(0,P.A)(L,b,[],!1,null,null,null).exports;var I=function(){var t=this,e=t._self._c;return e("nc-text-field",{staticClass:"passwords-widget-search",attrs:{value:t.value,label:t.t("DashboardSearchLabel"),"trailing-button-icon":"close","show-trailing-button":""!==t.value},on:{"update:value":function(e){t.value=e},"trailing-button-click":t.clearText}},[e("magnify-icon",{attrs:{size:20}})],1)};I._withStripped=!0;var z=s(5528);const N={components:{NcTextField:s(82182).A,MagnifyIcon:z.A},data:()=>({value:""}),inject:["helper"],methods:{clearText(){this.value=""}},watch:{value(t){this.helper.search(t)}}};s(74147);const D=(0,P.A)(N,I,[],!1,null,null,null).exports;class F{get ready(){return this._ready}get searchReady(){return this._searchReady}get mode(){return null===this._query?"favorites":"search"}get query(){return this._query}get passwords(){return this._passwords}constructor(t){this._passwords=[],this._passwordList=[],this._query=null,this._oldQuery=null,this._interval=null,this._ready=!1,this._searchReady=!1,this._api=t}init(){this._loadFavorites(),this._loadAllPasswords(!0),this._interval=setInterval((()=>{this._loadAllPasswords()}),6e4)}stop(){null!==this._interval&&clearInterval(this._interval),this._passwords=[],this._passwordList=[],this._query=null,this._oldQuery=null,this._ready=!1,this._searchReady=!1}_loadAllPasswords(t=!1){this._api.findPasswords().then((t=>{let e=d.A.objectToArray(d.A.sortApiObjectArray(t,this._getPasswordsSortingField()));e.length>0&&(this._passwordList=e,this._updateSearchResults(!0),this._ready=!0,this._searchReady=!0)})).catch((e=>{console.error(e),t&&this._loadAllPasswords()}))}_loadFavorites(){this._api.findPasswords({favorite:!0}).then((t=>{let e=d.A.objectToArray(d.A.sortApiObjectArray(t,this._getPasswordsSortingField()));e.length>0&&0===this._passwordList.length&&(this._passwordList=e,this._updateSearchResults(!0)),this._ready=!0})).catch(console.error)}search(t){t.length<3&&(t=null,this._oldQuery=null),this._query!==t&&(this._query=t,this._updateSearchResults())}_updateSearchResults(t=!1){null!==this._query?this._findQueryResults(t):this._findFavorites()}_findFavorites(){let t=[];for(let e of this._passwordList)e.favorite&&t.push(e);t.length>0?this._overwriteArray(this._passwords,t):this._passwordList.length>0?this._overwriteArray(this._passwords,this._passwordList.slice(0,10)):this._overwriteArray(this._passwords,[])}_findQueryResults(t){let e=[],s=this._query,i=this._passwordList;t||null===this._oldQuery||0!==s.indexOf(this._oldQuery)||(i=this._passwords);for(let t of i){let i=0;for(let e of["label","username","notes","url"])i+=this._countOccurrencesInString(t[e],s);for(let e of t.customFields)"secret"!==e.type&&"data"!==e.type&&"file"!==e.type&&(i+=this._countOccurrencesInString(e.value,s));i>0&&e.push({matches:i,password:t})}if(e.sort(((t,e)=>{let s=e.matches-t.matches;return 0===s&&t.password.favorite!==e.password.favorite?t.password.favorite?-1:1:s})),s===this._query){this._oldQuery=s,this._overwriteArray(this._passwords,[]);for(let t of e)this._passwords.push(t.password)}}_countOccurrencesInString(t,e){if(e.length>t.length||0===e.length)return 0;let s=0,i=0;for(;i=t.indexOf(e,i),i>=0;)s++,i+=e.length;return s}_overwriteArray(t,e){for(;void 0!==t.pop(););for(let s of e)t.push(s)}_getPasswordsSortingField(){let t=_.get("client.ui.password.field.sorting");return"byTitle"===t&&(t=_.get("client.ui.password.field.title")),t}}const j={components:{PasswordSearch:D,PasswordItem:T,NcLoadingIcon:m.A,NcEmptyContent:A.A,KeyVariantIcon:v.A},data(){return{helper:new F(this.api)}},inject:["api"],provide(){return{helper:this.helper}},mounted(){this.helper.init()},destroyed(){this.helper.stop()},computed:{emptyText(){return"search"===this.helper.mode?this.t("DashboardNoResults"):this.t("DashboardNoPasswords")},emptyDescription(){return"search"===this.helper.mode?this.helper.searchReady?this.t("DashboardNoResultsText",{query:this.helper.query}):this.t("DashboardResultsLoading"):this.t("DashboardNoPasswordsText")},hasPasswords(){return this.helper.ready&&this.helper.passwords.length>0},hasSearch(){return this.helper.ready&&(this.helper.passwords.length>0||"search"===this.helper.mode)}}};s(19823);const Q=(0,P.A)(j,y,[],!1,null,null,null).exports;var E=function(){var t=this,e=t._self._c;return e("form",{staticClass:"passwords-widget-login",on:{submit:function(e){return e.preventDefault(),e.stopPropagation(),t.submitLogin.apply(null,arguments)}}},[t.error?e("nc-note-card",{attrs:{type:"error",heading:t.t("DashboardLoginError")}},[e("p",[t._v(t._s(t.t(t.error)))])]):t._e(),t._v(" "),e("nc-password-field",{attrs:{value:t.password,minlength:12,disabled:t.loggingIn,placeholder:t.t("Password")},on:{"update:value":function(e){t.password=e}}}),t._v(" "),e("nc-button",{attrs:{alignment:"center-reverse",type:"primary",nativeType:"submit",disabled:t.loggingIn||!t.ready,wide:""},scopedSlots:t._u([{key:"icon",fn:function(){return[t.loggingIn?e("nc-loading-icon",{attrs:{size:20}}):e("arrow-right",{attrs:{size:20}})]},proxy:!0}])},[t._v("\n        "+t._s(t.t("Login"))+"\n    ")])],1)};E._withStripped=!0;var M=s(74095),U=s(92610),W=s(5137),B=s(16044);s(45853);const H=new class{info(t,e={}){return new Promise((s=>{this._promisifyToast(e,s),this._runNextcloudDialog(t,e,"showInfo")}))}message(t,e={}){return new Promise((s=>{this._promisifyToast(e,s),this._runNextcloudDialog(t,e,"showMessage")}))}success(t,e={}){return new Promise((s=>{this._promisifyToast(e,s),this._runNextcloudDialog(t,e,"showSuccess")}))}warning(t,e={}){return new Promise((s=>{this._promisifyToast(e,s),this._runNextcloudDialog(t,e,"showWarning")}))}error(t,e={}){return new Promise((s=>{this._promisifyToast(e,s),this._runNextcloudDialog(t,e,"showError")}))}_promisifyToast(t,e){t.onClick=()=>{e&&e(!0)},t.onRemove=()=>{e&&e(!1)}}_runNextcloudDialog(t,e,i){Promise.all([s.e(8497),s.e(6874),s.e(5289),s.e(1693)]).then(s.bind(s,75289)).then((s=>{s[i](O.A.translateArray(t),e)}))}};class V{run(){_.set("client.encryption.webauthn.enabled",!1),H.info("WebAuthnLoginDisabled")}}var K=s(21777);class G{static hasBeenAttempted=!1;isAvailable(){return!G.hasBeenAttempted&&!!window.PasswordCredential&&_.get("client.encryption.webauthn.enabled")}async run(){if(!this.isAvailable()||G.hasBeenAttempted)return null;G.hasBeenAttempted=!0;try{let t=`${(0,K.HW)().uid}.passwordsapp@${location.host}`,e=await navigator.credentials.get(new PasswordCredential({password:!0,id:t}));if(e&&e.password)return e.password}catch(t){p.A.error(t)}return null}}const J={components:{NcLoadingIcon:m.A,NcButton:M.default,NcPasswordField:B.A,ArrowRight:U.A,NcNoteCard:W.A},inject:["api"],data:()=>({password:"",salts:[],loggingIn:!1,ready:!1,error:null,webAuthnAction:new G}),created(){this.requestSession()},methods:{async requestSession(){try{let t=await this.api.requestSession();if(!t.hasOwnProperty("challenge"))return void this.tryLogin([]);this.salts=t.challenge.salts,this.ready=!0,await this.tryWebAuthn()}catch(t){this.loginError(t)}},async tryWebAuthn(){if(this.webAuthnAction.isAvailable()){let t=await this.webAuthnAction.run();t&&(this.password=t,this.tryLogin({password:t,salts:this.salts}))}},submitLogin(){this.tryLogin({password:this.password,salts:this.salts})},tryLogin(t,e=!1){!this.loggingIn&&this.ready&&(this.loggingIn=!0,this.error=null,this.api.openSession(t).catch((t=>{this.loginError(t,e)})))},loginError(t,e=!1){t.response&&403===t.response.status?this.error="Password invalid. Session revoked for too many failed login attempts.":t.message?this.error=t.message:this.error="Unknown Error",e&&(new V).run(),this.password="",this.loggingIn=!1}}};s(48379);const X={components:{PasswordsView:Q,AuthenticationView:(0,P.A)(J,E,[],!1,null,null,null).exports},props:{api:{type:Object}},provide(){return{api:this.api}},computed:{isAuthorized:()=>f.A.isAuthorized}};s(38885);const Y=(0,P.A)(X,g,[],!1,null,null,null).exports;class Z{get api(){return c.getLegacyClient()}get clientService(){return c}get settingsService(){return _}get vue(){return w.Ay}get dashboardWidget(){return Y}}},2065:()=>{},68111:()=>{},40093:()=>{},33801:()=>{}}]);